@startuml img/OAuth.png
skin BlueModern
title OAuth - Questor Achievement-System
actor Player
Player -> iFrame: request(Achievements)

== Get TemporaryCredentials ==
iFrame -> AchievementSystem: request(achv/initiate)
note left
	POST achv/initiate HTTP/1.1
     	Host: questor.achvsystem.de
     	Authorization: OAuth realm="Achievements",
        oauth_consumer_key="dpf43f3p2l4k3l03",
        oauth_signature_method="HMAC-SHA1",
        oauth_timestamp="137131200",
        oauth_nonce="wIjqoS",
        oauth_callback="http%3A%2F%2Fquestor.achv.de%2Fready",
        oauth_signature="74KNZJeDHnMBp0EMJ9ZHt%2FXKycU%3D"	
end note
AchievementSystem -> AchievementSystem: validateRequest
AchievementSystem --> iFrame: response(TemporaryCredentials)
note right
HTTP/1.1 200 OK
     Content-Type: application/x-www-form-urlencoded
     oauth_token=hh5s93j4hdidpola&oauth_token_secret=hdhd0244k9j7ao03&
     oauth_callback_confirmed=true
end note

== Get Authorization ==
iFrame -> Customer: requestAuthorization(oauth_token)
note left
	https://customer.exmaple.com/authorize?oauth_token=hh5s93j4hdidpola
end note
Customer --> iFrame: response(EnterUserNameAndPassword)
iFrame -> Customer: request(Username, Password)
Customer --> iFrame: response(YouWantToAccessAchievements)
iFrame -> Customer: request("Ok")
Customer -> AchievementSystem: request(achv/ready?oauth_token&oauth_verifer)
note left
	http://questor.achv.de/ready?oauth_token=hh5s93j4hdidpola&oauth_verifier=hfdp7dh39dks9884
end note
Customer --> iFrame: redirect(/achv/token)

== Get TokenCredentials ==
iFrame -> AchievementSystem: request(/achv/token)
note left
 	POST /achv/token HTTP/1.1
	Host: questor.achv.de
	Authorization: OAuth realm="Achievements",
        oauth_consumer_key="dpf43f3p2l4k3l03",
        oauth_token="hh5s93j4hdidpola",
        oauth_signature_method="HMAC-SHA1",
        oauth_timestamp="137131201",
        oauth_nonce="walatlh",
        oauth_verifier="hfdp7dh39dks9884",
        oauth_signature="gKgrFCywp7rO0OXSjdot%2FIHF7IU%3D"
end note
AchievementSystem -> AchievementSystem: validateRequest
AchievementSystem --> iFrame: response(TokenCredentials)
note right
	HTTP/1.1 200 OK
	Content-Type: application/x-www-form-urlencoded
	oauth_token=nnch734d00sl2jdk&oauth_token_secret=pfkkdhi9sl3r4s00
end note

== Get Achievements ==
iFrame -> AchievementSystem: request(/achv/achievements)
note left
	GET /achv/achievements HTTP/1.1
	Host: questor.achv.de
	Authorization: OAuth realm="Achievements",
        oauth_consumer_key="dpf43f3p2l4k3l03",
        oauth_token="nnch734d00sl2jdk",
        oauth_signature_method="HMAC-SHA1",
        oauth_timestamp="137131202",
        oauth_nonce="chapoH",
        oauth_signature="MdpQcU8iPSUjWoN%2FUDMsK2sui9I%3D"
end note
AchievementSystem -> AchievementSystem: validateRequest
AchievementSystem --> iFrame: response(Achievements)
@enduml
